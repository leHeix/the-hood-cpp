#pragma once

namespace vehicles
{
	struct stVehicleModelData
	{
		float max_fuel;
		int price;
	};

	constexpr inline std::array<stVehicleModelData, 212> model_data{{
		{ 100.0, 0 },           // 400
		{ 50.0, 0 },            // 401 - Bravura
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 55.0, 0 },            // 410 - Manana
		{ 100.0, 0 },
		{ 45.0, 0 },            // 412 - Voodoo
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 75.0, 0 },            // 418 - Moonbeam
		{ 50.0, 0 },            // 419 - Esperanto
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 50.0, 0 },            // 426 - Premier
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },           // 436 - Previon
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 60.0, 0 },            // 458 - Solair
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 20.0, 0 },            // 461 - PCJ-600
		{ 25.0, 0 },            // 462 - Faggio
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 80.0, 0 },            // 482 - Burrito
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 45.0, 0 },            // 491 - Virgo
		{ 50.0, 0 },            // 492 - Greenwood
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 55.0, 0 },            // 507 - Elegant
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 65.0, 0 },            // 516 - Nebula
		{ 50.0, 0 },            // 517 - Majestic
		{ 52.5, 0 },            // 518 - Buccaneer
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 27.5, 0 },            // 521 - FCR-900
		{ 30.0, 0 },            // 522 - NRG-500
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 57.5, 0 },            // 534 - Remington
		{ 65.0, 0 },            // 535 - Slamvan
		{ 50.0, 0 },            // 536  Blade
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 50.0, 0 },            // 547 - Primo
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 45.0, 0 },            // 567 - Savanna
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 42.5, 0 },            // 576 - Tornado
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 },
		{ 100.0, 0 }
	}};

	std::array<std::unique_ptr<CVehicle>, MAX_VEHICLES> vehicle_pool;
}

class CVehicle
{
public:
	enum class engine_state : std::uint8_t
	{
		off = 0,
		on = 1,
		default_state = 2
	};

	enum gearbox : std::int8_t
	{
		R = -1,
		N = 0,
		first = 1,
		second = 2,
		third = 3,
		fourth = 4
	};

private:
	int _vehicleid{ INVALID_VEHICLE_ID };
	int _dbid{ 0 };
	CPlayer* _owner{ nullptr };

	std::uint16_t _modelid;
	glm::vec4 _position;
	int _world;
	int _interior;
	float _health{ 1000.F };

	std::pair<int, int> _color;
	int _paintjob{ 3 };
	float _fuel{ 0.F };
	bool _locked{ false };
	bool _alarm{ false };
	std::array<int, 14> _components;
	int _gearbox{ gearbox::N };

	struct
	{
		timers::CTimer* update;
	} _timers;

	void Update(timers::CTimer* timer);
	void StartUpdating();
	void StopUpdating();

	CVehicle(std::uint16_t modelid, glm::vec4 position, std::pair<int, int> color);

public:
	static inline constexpr float VEHICLE_FUEL_DIVISOR = 20000.F;
	~CVehicle();

	static CVehicle* create(std::uint16_t modelid, glm::vec4 position, std::pair<int, int> color);

	inline std::uint16_t ID() const { return _vehicleid; }
	inline bool Valid() const { return _vehicleid != INVALID_VEHICLE_ID; }
	inline float GetSpeed() const 
	{
		float x, y, z;
		GetVehicleVelocity(_vehicleid, &x, &y, &z);
		return VectorSize(x, y, z) * 180.F;
	}
	
	inline engine_state Engine() const
	{
		int engine, param;
		GetVehicleParamsEx(_vehicleid, &engine, &param, &param, &param, &param, &param, &param);
		return static_cast<engine_state>(engine);
	}

	void ToggleEngine(engine_state state = engine_state::default_state);
	CPlayer* GetDriver();

	bool RegisterToPlayer(CPlayer* player);
};